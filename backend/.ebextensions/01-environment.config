option_settings:

  # Node.js platform settings
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "node dist/server.js"
    ProxyServer: nginx

  # Environment type
  aws:elasticbeanstalk:environment:
    EnvironmentType: LoadBalanced
    ServiceRole: aws-elasticbeanstalk-service-role
    LoadBalancerType: application

  # Instance configuration
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.micro
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    SecurityGroups: default

  # Auto-scaling
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 4
    Cooldown: 360

  # Auto-scaling triggers
  aws:autoscaling:trigger:
    MeasureName: CPUUtilization
    Statistic: Average
    Unit: Percent
    UpperThreshold: 75
    LowerThreshold: 25
    UpperBreakSize: 1
    LowerBreakSize: 1
    Period: 5
    BreachDuration: 5

  # Health check
  aws:elasticbeanstalk:application:
    Application Healthcheck URL: /api/health

  # Health reporting
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced

  # Load balancer listener (HTTPS)
  aws:elbv2:listener:443:
    Protocol: HTTPS
    SSLCertificateArns: arn:aws:acm:ap-south-1:ACCOUNT_ID:certificate/CERT_ID
    DefaultProcess: default

  # Load balancer listener (HTTP redirect)
  aws:elbv2:listener:default:
    ListenerEnabled: true
    Protocol: HTTP

  # Process settings
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /api/health
    Port: 5000
    Protocol: HTTP

  # Enable WebSocket support (sticky sessions)
  aws:elasticbeanstalk:environment:process:default:
    StickinessEnabled: true
    StickinessLBCookieDuration: 86400

  # Deployment policy
  aws:elasticbeanstalk:command:
    DeploymentPolicy: RollingWithAdditionalBatch
    BatchSizeType: Percentage
    BatchSize: 50
    Timeout: 600

  # Rolling updates
  aws:autoscaling:updatepolicy:rollingupdate:
    RollingUpdateEnabled: true
    RollingUpdateType: Health
    MinInstancesInService: 1
    MaxBatchSize: 1

  # Stream logs to CloudWatch
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 14
